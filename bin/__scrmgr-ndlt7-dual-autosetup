#!/bin/node

const fs = require('fs');
const child_process = require('child_process');

child_process.exec('xrandr', function (err, stdin, stderr) {
    var dp1status = stdin.split('\n').slice(2);
    var dp1lineIndex = -1;
    for (var i = 0; i < dp1status.length; i++) {
        if (dp1status[i].match('DP-1 connected')) {
            dp1lineIndex = i;
        };
    };

    var bestResolutionLine = dp1status[dp1lineIndex+1];
    var matchResult = bestResolutionLine.match(/\d+x\d+/);

    if (matchResult) {
        console.log(`Mounting DP-1 (${matchResult[0]})...`);
        child_process.exec(`xrandr --output eDP-1 --primary --mode 1920x1080 --pos 0x0 --rotate normal --output DP-1 --mode ${matchResult[0]} --pos 1920x0 --rotate normal --output HDMI-1 --off --output HDMI-2 --off --output VIRTUAL1 --off`);
    };
});
